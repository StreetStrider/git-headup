#! /usr/bin/env node

require('console-ultimate/global').replace()

var minimist = require('minimist')

var capture = require('./lib/capture')


var commands =
{
	tag: require('./lib/tag')

	// log: require('./lib/log'),
	// test: test
}


var cmd  = process.argv[2]
var argv = process.argv.slice(3)
var args = minimist(argv)

var result = (commands[cmd] || notFound)(args, cmd, argv)

capture(result)
.then(function (result)
{
	if (result != null)
	{
		process.stdout.write(result)
	}
	process.exit()
},
function (error)
{
	console.error(error.message)
	process.exit(-2)
})


function notFound (_, cmd)
{
	console.error('command `%s` not found', cmd)
	process.exit(-1)
}

function test ()
{

}
