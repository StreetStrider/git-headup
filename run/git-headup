#! /usr/bin/env node

require('console-ultimate/global').replace()

var minimist = require('minimist')

var config = require('./lib/git/git-config')
var unpair = require('./lib/unpair')


var commands =
{
	t: require('./lib/t'),
	test: test
}


var cmd  = process.argv[2]
var argv = process.argv.slice(3)
var args = minimist(argv)

var result = (commands[cmd] || notFound)(args, cmd, argv)

Promise.resolve(result)
.then(function (result)
{
	result = unpair(result)
	result = String(result)

	process.stdout.write(result)
	process.exit()
},
function (error)
{
	console.error(error.message)
	process.exit(-2)
})


function notFound (_, cmd)
{
	console.error('command `%s` not found', cmd)
	process.exit(-1)
}

function test ()
{
	return config('log-depth')
}
